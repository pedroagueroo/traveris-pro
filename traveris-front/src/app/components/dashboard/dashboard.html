<div class="container mt-4 pb-5">
  <div class="row mb-4 align-items-center">
    <div class="col-md-6">
      <h2 class="fw-bold text-dark mb-0">Panel de Control General</h2>
      <p class="text-muted small mb-0">Sistema Integral de Gestión Turística</p>
    </div>
    <div class="col-md-6 text-md-end mt-3 mt-md-0">
      <span class="badge bg-light text-primary border border-primary px-3 py-2 me-2 shadow-sm">
        <i class="bi bi-building-fill me-1"></i> Agencia: {{ nombreEmpresa }}
      </span>
      <span class="badge bg-dark text-white px-3 py-2 shadow-sm">
        <i class="bi bi-currency-dollar text-success me-1"></i>
        Dólar Oficial: Compra ${{ cotizacionBlue.compra }} | Venta ${{ cotizacionBlue.venta }}
      </span>
    </div>
  </div>

  <div class="row g-3 mb-5 text-center">
    <div class="col-md-3">
      <div class="card bg-danger text-white shadow border-0 h-100">
        <div class="card-body">
          <h6 class="text-uppercase small fw-bold opacity-75">Saldos a Cobrar</h6>
          <h3 class="fw-bold">USD {{ stats.saldoPendienteGlobal | number:'1.2-2' }}</h3>
          <p class="mb-0 extra-small">Deuda de pasajeros</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-dark shadow border-0 h-100">
        <div class="card-body">
          <h6 class="text-uppercase small fw-bold opacity-75">Saldos a Pagar</h6>
          <h3 class="fw-bold">USD {{ stats.deudaProveedoresGlobal | number:'1.2-2' }}</h3>
          <p class="mb-0 extra-small">Deuda a operadores</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-primary text-white shadow border-0 h-100">
        <div class="card-body">
          <h6 class="text-uppercase small fw-bold opacity-75">En Curso</h6>
          <h3 class="fw-bold">{{ stats.legajosActivos }}</h3>
          <p class="mb-0 extra-small">Operaciones abiertas</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white shadow border-0 h-100">
        <div class="card-body">
          <h6 class="text-uppercase small fw-bold opacity-75">Total Histórico</h6>
          <h3 class="fw-bold">{{ stats.totalLegajos }}</h3>
          <p class="mb-0 extra-small">Volumen de ventas</p>
        </div>
      </div>
    </div>
  </div>

  <h5 class="text-muted fw-bold mb-3 text-uppercase small">Acciones Rápidas</h5>
  <div class="row g-3 mb-5">
    <div class="col-6 col-md-3">
      <button class="btn btn-outline-primary w-100 py-3 shadow-sm fw-bold" routerLink="/clientes">
        <i class="bi bi-people fs-3 d-block mb-2"></i> Clientes
      </button>
    </div>
    <div class="col-6 col-md-3">
      <button class="btn btn-outline-success w-100 py-3 shadow-sm fw-bold" routerLink="/clientes/nuevo">
        <i class="bi bi-person-plus fs-3 d-block mb-2"></i> Nuevo Pasajero
      </button>
    </div>
    <div class="col-6 col-md-3">
      <button class="btn btn-outline-warning w-100 py-3 shadow-sm fw-bold text-dark" routerLink="/reservas">
        <i class="bi bi-calendar-check fs-3 d-block mb-2"></i> Reservas
      </button>
    </div>
    <div class="col-6 col-md-3">
      <button class="btn btn-outline-danger w-100 py-3 shadow-sm fw-bold" routerLink="/caja">
        <i class="bi bi-cash-coin fs-3 d-block mb-2"></i> Caja
      </button>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-white py-3">
          <h5 class="mb-0 text-primary fw-bold"><i class="bi bi-clock-history me-2"></i>Últimos Movimientos de Caja</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 text-center">
              <thead class="table-light">
                <tr>
                  <th>Fecha</th>
                  <th>Legajo</th>
                  <th>Concepto</th>
                  <th>Moneda</th>
                  <th class="text-end">Importe</th>
                  <th class="text-center">Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let m of movimientos" class="animate-fade-in">
                  <td class="small text-muted">{{ m.fecha_pago | date:'dd/MM/yy HH:mm' }}hs</td>
                  <td><span class="fw-bold text-dark">#{{ m.nro_legajo }}</span></td>
                  <td><small class="fw-bold text-uppercase" style="font-size: 0.7rem;">{{ m.tipo_movimiento }}</small></td>
                  <td>
                    <span class="badge rounded-pill" [ngClass]="m.moneda === 'USD' ? 'bg-success-subtle text-success border border-success' : 'bg-secondary-subtle text-secondary border border-secondary'">
                      {{ m.moneda }}
                    </span>
                  </td>
                  <td class="text-end fw-bold" [class.text-danger]="m.monto < 0" [class.text-success]="m.monto > 0">
                    {{ m.monto | number:'1.2-2' }}
                  </td>
                  <td class="text-center">
                    <div class="d-flex justify-content-center gap-2">
                      <button class="btn btn-sm btn-outline-primary rounded-circle" [routerLink]="['/reservas', m.nro_legajo]"><i class="bi bi-eye"></i></button>
                      <button class="btn btn-sm btn-outline-danger rounded-circle" (click)="eliminarMovimiento(m.id)"><i class="bi bi-trash"></i></button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="notification-wrapper" *ngIf="alertasRadar.length > 0">
    <div class="notification-bell" (click)="mostrarAlertas = !mostrarAlertas">
      <i class="bi bi-bell-fill text-white"></i>
      <span class="bell-badge">{{ alertasRadar.length }}</span>
    </div>

    <div class="notification-panel shadow animate__animated animate__fadeInUp" *ngIf="mostrarAlertas">
      <div class="p-2 bg-danger text-white d-flex justify-content-between align-items-center">
        <h6 class="mb-0 fw-bold">Alertas del Día</h6>
        <i class="bi bi-x-lg cursor-pointer" (click)="mostrarAlertas = false" style="font-size: 0.7rem;"></i>
      </div>

      <div class="notif-list" style="max-height: 350px; overflow-y: auto;">
        <div class="notif-item border-bottom p-3" *ngFor="let alerta of alertasRadar">
          <div class="d-flex justify-content-between align-items-center">
            
            <div *ngIf="alerta.tipoAlerta === 'PAGO'" [routerLink]="['/reservas', alerta.id]" (click)="mostrarAlertas = false" style="cursor: pointer; flex: 1;">
              <span class="d-block fw-bold text-dark small text-uppercase">{{ alerta.titular }}</span>
              <small class="text-muted d-block">Legajo #{{alerta.id}} - Vence: {{alerta.fecha_limite_pago | date:'dd/MM/yy'}}</small>
              <span class="badge bg-danger-subtle text-danger border mt-1" style="font-size: 0.6rem;">DEUDA: USD {{alerta.saldo_pendiente | number:'1.2-2'}}</span>
            </div>

            <div *ngIf="alerta.tipoAlerta === 'CUMPLE'" style="flex: 1;">
              <span class="d-block fw-bold text-primary small text-uppercase">
                <i class="bi bi-cake2-fill me-1"></i> {{ alerta.nombre_completo }}
              </span>
              <small class="text-muted d-block">¡Hoy es su cumpleaños!</small>
              <button class="btn btn-sm btn-success py-1 mt-1 w-100" style="font-size: 0.65rem;" (click)="enviarFelicidades(alerta)">
                <i class="bi bi-envelope-heart me-1"></i> Saludar por Mail
              </button>
            </div>

            <i class="bi bi-chevron-right text-muted small ms-2" *ngIf="alerta.tipoAlerta === 'PAGO'"></i>
          </div>
        </div>
      </div>

      <div class="p-2 text-center bg-light">
        <small class="text-muted" style="font-size: 0.65rem;">Centro de Notificaciones Vicka Turismo</small>
      </div>
    </div>
  </div>
</div>