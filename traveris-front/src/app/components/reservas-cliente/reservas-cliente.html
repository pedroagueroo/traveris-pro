<div class="container-fluid p-4 animate-fade-in">
    <header class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 fw-bold m-0">Historial de Legajos - {{ nombreCliente || 'Cliente #' + clienteId }}</h1>
            <p class="text-muted small">Gestión centralizada de expedientes del pasajero</p>
        </div>
        <button class="btn btn-outline-secondary btn-sm rounded-pill px-3" (click)="router.navigate(['/clientes'])">
            Volver a Clientes
        </button>
    </header>

    <div class="d-flex gap-2 mb-4 bg-white p-2 rounded-3 shadow-sm border">
        <button class="btn btn-sm px-3 rounded-pill"
            [ngClass]="filtroActual === 'TODAS' ? 'btn-primary' : 'btn-light border'"
            (click)="aplicarFiltro('TODAS')">Todas</button>
        <button class="btn btn-sm px-3 rounded-pill"
            [ngClass]="filtroActual === 'EN_CURSO' ? 'btn-success' : 'btn-light border'"
            (click)="aplicarFiltro('EN_CURSO')">Abiertas / En Curso</button>
        <button class="btn btn-sm px-3 rounded-pill"
            [ngClass]="filtroActual === 'CERRADA' ? 'btn-danger' : 'btn-light border'"
            (click)="aplicarFiltro('CERRADA')">Cerradas</button>

    </div>

    <div class="glass-card shadow-sm border-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="border-0 small fw-bold text-muted ps-4">LEGAJO #</th>
                        <th class="border-0 small fw-bold text-muted">DESTINO</th>
                        <th class="border-0 small fw-bold text-muted">FECHA SALIDA</th>
                        <th class="border-0 small fw-bold text-muted">FECHA REGRESO</th>
                        <th class="border-0 small fw-bold text-muted">ESTADO</th>
                        <th class="border-0 small fw-bold text-muted text-end pe-4">ACCIÓN</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let r of reservasPaginadas">
                        <td class="ps-4 fw-bold">#{{ r.id }}</td>
                        <td><span class="text-uppercase fw-bold small text-primary">{{ r.destino_final || '---'
                                }}</span></td>
                        <td>{{ r.fecha_viaje_salida | date:'dd/MM/yyyy' }}</td>
                        <td>{{ r.fecha_viaje_regreso | date:'dd/MM/yyyy' }}</td>
                        <td>
                            <span class="badge rounded-pill px-3 py-2" [ngClass]="{
                                    'bg-success-soft text-success': r.estado?.toUpperCase() === 'ABIERTO', 
                                    'bg-danger-soft text-danger': r.estado?.toUpperCase() === 'CERRADO',
                                    'bg-dark-soft text-dark': r.estado?.toUpperCase() === 'CANCELADA'
                                }">
                                {{ r.estado || 'SIN ESTADO' }}
                            </span>
                        </td>
                        <td class="text-end pe-4">
                            <div class="d-flex justify-content-end gap-2">
                                <button class="btn btn-primary btn-sm rounded-pill px-3 shadow-sm"
                                    (click)="verDetalle(r.id)">
                                    Ver Detalle
                                </button>
                                <button
                                    class="btn btn-outline-warning btn-sm rounded-circle d-flex align-items-center justify-content-center"
                                    style="width: 32px; height: 32px;" [routerLink]="['/reservas/editar', r.id]"
                                    title="Editar">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-outline-danger btn-sm rounded-circle shadow-sm"
                                    style="width: 32px; height: 32px;" (click)="eliminarReserva(r.id)" title="Eliminar">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr *ngIf="reservasFiltradas.length === 0">
                        <td colspan="6" class="text-center py-5">
                            <i class="bi bi-folder-x h1 text-muted d-block mb-3"></i>
                            <p class="text-muted mb-0">No se encontraron legajos con el filtro seleccionado.</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="card-footer bg-white border-0 py-3 d-flex justify-content-between align-items-center px-4"
            *ngIf="reservasFiltradas.length > 5">
            <small class="text-muted">Mostrando {{ reservasPaginadas.length }} de {{ reservasFiltradas.length }}
                legajos</small>
            <div class="pagination-controls d-flex gap-2">
                <button class="btn btn-light border btn-sm rounded-circle" [disabled]="paginaActual === 1"
                    (click)="cambiarPagina(-1)">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <span class="align-self-center small fw-bold">Página {{ paginaActual }} de {{ totalPaginas() }}</span>
                <button class="btn btn-light border btn-sm rounded-circle" [disabled]="paginaActual === totalPaginas()"
                    (click)="cambiarPagina(1)">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</div>